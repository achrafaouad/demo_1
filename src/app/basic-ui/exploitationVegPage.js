import React, { Component } from "react";
import OlMap from "ol/Map";
import OlView from "ol/View";
import OlLayerTile from "ol/layer/Tile";
import OlSourcexyz from "ol/source/XYZ";
import VectorSource from "ol/source/Vector";
import olVectorLayer from "ol/layer/Vector";
import Style from "ol/style/Style";
import Fill from "ol/style/Fill";
import Stroke from "ol/style/Stroke";
import GeoJSON from "ol/format/GeoJSON";
import "ol/ol.css";
import Popup from "./popupAddAnimal";
import Alimantation from "./alimentation";
import AnimalTable from "./animalTable";
import Modifier from "./Modifier";
const style = {
    display: "grid",
    gridTemplateColumns: "50%  50%"}

class ExploitationVegPage extends Component{
    constructor(props){
        super(props);
        var choosen = this.props.exploitation
        var mycenter = JSON.parse(choosen.geometry).coordinates[0][0]
        console.log(mycenter)
        let zoom1  = choosen.surface>10?10:16
        this.state={choosen:choosen ,center: mycenter, afficher_animal: false , zoom:zoom1}
        


        console.log( "ha state",this.state)
        this.afficher_animal = this.afficher_animal.bind(this)
        this.arcgisMap = new OlLayerTile({
            source: new OlSourcexyz({
              url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
              maxZoom: 15,
              minZoom: 5,
            }),
          });
          this.olmap = new OlMap({
            target: null,
            
            layers: [
                this.arcgisMap],
      
              view: new OlView({
              center: this.state.center,
              zoom: this.state.zoom,
              minZoom: 2,
            }),
          });


    this.mediumLow = new VectorSource();
    this.mediumLowVector = new olVectorLayer({
      title: "medium low Risk",

      source: this.mediumLow,

      style: new Style({
        stroke: new Stroke({
          // color: symbolLineColor,

          width: 1,

          // lineDash: [4, 8]
        }),

        fill: new Fill({
          color: "#FFC100",
        }),
      }),
    });
    this.format = new GeoJSON();


    }
    updateMap() {
        console.log("update_map");
        this.olmap.getView().setCenter(this.state.center);
        this.olmap.getView().setZoom(this.state.zoom);
      }

    async fetch_data() {

        fetch("http://localhost:3001/getFoncierDisposé", {
            method: "POST",
            body: {id:50},
          })
            .then(
              (response) => {
                if (response.ok) {
                  return response.json();
                }
                throw new Error("request failed");
              },
              (networkError) => console.log(networkError)
            )
            .then((responseJson) => {
              console.log(responseJson);
              this.setState({ src: responseJson });
            });
        }

        componentDidMount(){
            console.log("hello world ha l map");
            this.olmap.setTarget("map1");
    this.olmap.on("moveend", () => {
        let center = this.olmap.getView().getCenter();
        let zoom = this.olmap.getView().getZoom();
        this.setState({ center, zoom });
      });
      
      
        // let jsonData = JSON.parse(geometry)
        // jsonData["crs"] = {"type":"name","properties":{"name":"EPSG:3857"}}
        
        if(this.state.choosen.geometry){
        this.mediumLow.addFeatures(
          this.format.readFeatures(this.state.choosen.geometry, { featureProjection: "EPSG:3857" })
        );
  
        this.olmap.addLayer(this.mediumLowVector);
     
        }
    }

    afficher_animal(){
      let afficher = this.state.afficher_animal === true ? false:true;
      this.setState({afficher_animal:afficher})
      
    }
        
        
           

    render(){
        return (<>
            { (!this.state.afficher_animal) && <>
                <button type="button" style={{width:"80px",margin:"20px"}} class="btn btn-success btn-sm" onClick ={()=> this.props.retour()}>retour</button>
             <h1 style={{color:"#ffff"}}>Détails de l'exploitation</h1>
             <hr style={{border: ".5px solid white"}}/>
            <div class="grid-container" style={style}>
            <div className="grid-item">
            
            <div style={{margin: "15px",color:"black", width:"100%"}} className=" tc grow bg-near-white br3 pa3 ma2 dib bw2 shadow-5">
            <h3 style={{color:"#434c5e"}}>Information sur la parcelle</h3>
            <hr style={{border: ".2px solid white"}}/>
            <div  >
                <strong> Nom</strong> : {this.state.choosen.nom}
                
              </div>
            <div>
                <strong> Date_exploitation</strong> : {this.state.choosen.date_exploitation}
                
              </div>
            <div>
                <strong> Note</strong> : {this.state.choosen.note}
                
              </div>
            <div>
                <strong> culture permanent</strong> : {String(this.state.choosen.culture_permanent)}
                
              </div>
            
            <div>
                <strong> Irrigué</strong> : {String(this.state.choosen.errige)}
                
              </div>
              <div>
                <strong> surface occupée</strong> : {this.state.choosen.surface} ha
              </div>
              <div>
                <strong> Système d’irrigation</strong> : {(!this.state.choosen.système_irrigation)?"-":this.state.choosen.système_irrigation}
              </div>
              <div>
                <strong> A l’intérieur d’une zone spécifique</strong> : {(!this.state.choosen.zone_spécifique)?"-":this.state.choosen.zone_spécifique}
              </div>
              <div>
                <strong> Système de certification</strong> : {(!this.state.choosen.certification)?"-":this.state.choosen.certification}
              </div>
              <div>
                <strong>Zone vulnérable</strong> : {(!this.state.choosen.vulnérable)?"-":this.state.choosen.vulnérable}
              </div>
              
              <h3 style={{color:"#434c5e"}}>Source d’eau</h3>
            <hr style={{border: ".2px solid white"}}/>
            <div>
                <strong>Source d’eau dans la parcelle</strong> : {String(this.state.choosen.source_eau)}
              </div>
            <div>
                <strong>Distance de la source d’eau (m)</strong> : {(!this.state.choosen.distance_eau)?"-":this.state.choosen.distance_eau}
              </div>
            <div>
                <strong>Type de source d’eau</strong> : {(!this.state.choosen.type_source_eau)?"-":this.state.choosen.type_source_eau}
              </div>

            </div>
            <div style={{display: "flex"}}>
            <Modifier id={this.state.choosen.id_exploitation} expl={this.state.choosen}/>
            <button type="button" style={{width:"80px" , marginLeft:"10px"}} class="btn btn-success btn-sm">suprimer</button>
            </div>
            </div>
            <div class="grid-item">
                    <div
                    id="map1"
                    className="grid-margin"
                    style={{ width: "100%", height: "550px" }}
                >
          </div>
          
          
            </div>
            </div>
            </>}
            
            
        </>)
    }
}

export default ExploitationVegPage;